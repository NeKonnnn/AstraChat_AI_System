# ===========================================
# MemoAI Project - Environment Variables
# ===========================================
# Скопируйте этот файл в .env и настройте под ваше окружение
# cp env.example .env

# ===========================================
# ОСНОВНЫЕ НАСТРОЙКИ ПРОЕКТА
# ===========================================

# Режим работы (development, production, testing)
NODE_ENV=development
PYTHON_ENV=development

# Отладочный режим
DEBUG=true
LOG_LEVEL=INFO

# ===========================================
# НАСТРОЙКИ СЕРВИСОВ
# ===========================================

# Backend (MemoAI Backend)
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
BACKEND_WORKERS=1

# Frontend (React)
FRONTEND_HOST=0.0.0.0
FRONTEND_PORT=3000
REACT_APP_API_URL=http://localhost:8000
REACT_APP_WS_URL=ws://localhost:8000

# LLM Service (AI Models Service)
LLM_SVC_HOST=0.0.0.0
LLM_SVC_PORT=8001
LLM_SVC_INTERNAL_URL=http://llm-svc:8000
LLM_SVC_EXTERNAL_URL=http://localhost:8001

# ===========================================
# ПУТИ К МОДЕЛЯМ (настраиваемые)
# ===========================================

# LLM модели (большие языковые модели)
LLM_MODEL_PATH=./models/Qwen3-Coder-30B-A3B-Instruct-Q8_0.gguf
LLM_MODEL_NAME=qwen-coder-30b
LLM_MODEL_CTX_SIZE=4096
LLM_MODEL_GPU_LAYERS=0

# Vosk модели (речевое распознавание)
VOSK_MODEL_PATH=./models/vosk-model-small-ru-0.22

# Silero модели (синтез речи)
SILERO_MODELS_DIR=./models/silero

# WhisperX модели (продвинутое распознавание)
WHISPERX_MODELS_DIR=./models/whisperx

# Модели диаризации (разделение по спикерам)
DIARIZATION_MODELS_DIR=./models/diarization
DIARIZATION_CONFIG_PATH=./models/diarization/pyannote_diarization_config.yaml

# ===========================================
# ПРИМЕРЫ ДЛЯ РАЗНЫХ ОКРУЖЕНИЙ
# ===========================================

# ЛОКАЛЬНАЯ РАЗРАБОТКА (модели в Docker volumes)
# LLM_MODEL_PATH=/app/models/Qwen3-Coder-30B-A3B-Instruct-Q8_0.gguf
# VOSK_MODEL_PATH=/app/models/vosk-model-small-ru-0.22
# SILERO_MODELS_DIR=/app/models/silero
# WHISPERX_MODELS_DIR=/app/models/whisperx
# DIARIZATION_MODELS_DIR=/app/models/diarization

# ОБЛАЧНОЕ ХРАНИЛИЩЕ (S3, MinIO, Google Cloud Storage)
# LLM_MODEL_PATH=s3://my-bucket/models/Qwen3-Coder-30B-A3B-Instruct-Q8_0.gguf
# VOSK_MODEL_PATH=s3://my-bucket/models/vosk-model-small-ru-0.22
# SILERO_MODELS_DIR=s3://my-bucket/models/silero
# WHISPERX_MODELS_DIR=s3://my-bucket/models/whisperx
# DIARIZATION_MODELS_DIR=s3://my-bucket/models/diarization

# HTTP/HTTPS URL (скачивание моделей)
# LLM_MODEL_PATH=https://huggingface.co/microsoft/DialoGPT-medium/resolve/main/pytorch_model.bin
# VOSK_MODEL_PATH=https://alphacephei.com/vosk/models/vosk-model-small-ru-0.22
# SILERO_MODELS_DIR=https://models.silero.ai/models/tts/ru
# WHISPERX_MODELS_DIR=https://huggingface.co/whisperx/models
# DIARIZATION_MODELS_DIR=https://huggingface.co/pyannote/models

# ЛОКАЛЬНАЯ ФАЙЛОВАЯ СИСТЕМА
# LLM_MODEL_PATH=/home/user/models/Qwen3-Coder-30B-A3B-Instruct-Q8_0.gguf
# VOSK_MODEL_PATH=/home/user/models/vosk-model-small-ru-0.22
# SILERO_MODELS_DIR=/home/user/models/silero
# WHISPERX_MODELS_DIR=/home/user/models/whisperx
# DIARIZATION_MODELS_DIR=/home/user/models/diarization

# ===========================================
# НАСТРОЙКИ LLM СЕРВИСА
# ===========================================

# Генерация текста
LLM_DEFAULT_TEMPERATURE=0.7
LLM_DEFAULT_MAX_TOKENS=1024
LLM_STREAM=true

# Устройство для вычислений
CUDA_VISIBLE_DEVICES=0
DEVICE=auto  # auto, cpu, cuda

# WhisperX настройки
WHISPERX_DEVICE=auto
WHISPERX_COMPUTE_TYPE=float16
WHISPERX_LANGUAGE=ru
WHISPERX_BATCH_SIZE=16

# Диаризация настройки
DIARIZATION_DEVICE=auto
DIARIZATION_MIN_SPEAKERS=1
DIARIZATION_MAX_SPEAKERS=10
DIARIZATION_MIN_DURATION=1.0

# ===========================================
# НАСТРОЙКИ BACKEND
# ===========================================

# Микросервисы
USE_LLM_SVC=true
DOCKER_ENV=true
CONFIG_PATH=/app/config/config.yml

# Таймауты и повторы
LLM_SVC_TIMEOUT=300
LLM_SVC_RETRY_ATTEMPTS=3
LLM_SVC_RETRY_DELAY=1

# Память и кэширование
MEMORY_ENABLED=true
MEMORY_STORAGE_TYPE=file
MEMORY_FILE_PATH=/app/memory
MEMORY_MAX_HISTORY_LENGTH=100
MEMORY_AUTO_SAVE=true
MEMORY_SAVE_INTERVAL=30

# ===========================================
# НАСТРОЙКИ БАЗ ДАННЫХ
# ===========================================

# MongoDB - для хранения диалогов
MONGODB_HOST=localhost # при запуске из контейнера поменять на mongodb
MONGODB_PORT=27017
MONGODB_DATABASE=memoai
#MONGODB_USER= # admin (расскоменьтить и поставить свой user)
#MONGODB_PASSWORD= # password (расскоменьтить и поставить свой пароль)
# Строка подключения формируется автоматически, но можно задать вручную:
# MONGODB_CONNECTION_STRING=mongodb://admin:password@mongodb:27017/ 
# (где user - это имя, которое задается в MONGODB_USER, а password - пароль, который задается в MONGODB_PASSWORD)

# PostgreSQL + pgvector - для RAG системы
POSTGRES_HOST=postgresql
POSTGRES_PORT=5432
POSTGRES_DB=memoai
POSTGRES_USER=admin
POSTGRES_PASSWORD=password
# Размерность векторов для эмбеддингов (по умолчанию 384 для multilingual-MiniLM)
EMBEDDING_DIM=384

# Кэширование
CACHING_ENABLED=true
CACHING_TYPE=memory
CACHING_TTL=300
CACHING_MAX_SIZE=1000

# ===========================================
# НАСТРОЙКИ CORS
# ===========================================

# Разрешенные источники (через запятую)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000,http://127.0.0.1:3000,http://127.0.0.1:8000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=*
CORS_ALLOW_HEADERS=*

# ===========================================
# НАСТРОЙКИ БЕЗОПАСНОСТИ
# ===========================================

# API ключи
API_KEY=your-secret-api-key-here
ENABLE_SECURITY=false  # true для продакшена

# Rate limiting
RATE_LIMITING_ENABLED=false
RATE_LIMITING_REQUESTS_PER_MINUTE=60

# ===========================================
# LDAP АУТЕНТИФИКАЦИЯ (Active Directory)
# ===========================================

# Включить LDAP аутентификацию
LDAP_ENABLED=false  # Установите true для использования LDAP/AD

# Адрес LDAP/Active Directory сервера
# Примеры:
# - ldap://ad.company.local:389 (незащищенное соединение)
# - ldaps://ad.company.local:636 (защищенное соединение через SSL)
LDAP_SERVER=ldap://ad.company.local:389

# Базовое DN (Distinguished Name) для поиска пользователей
# Для Active Directory обычно dc=company,dc=local
LDAP_BASE_DN=dc=company,dc=local

# Шаблон DN пользователя (используйте {username} как placeholder)
# Варианты для Active Directory:
# 1. CN формат: cn={username},ou=Users,dc=company,dc=local
# 2. UPN формат: {username}@company.local (указывается в коде автоматически)
# 3. SAM формат: COMPANY\{username} (указывается в коде автоматически)
LDAP_USER_DN_TEMPLATE=cn={username},ou=Users,dc=company,dc=local

# Фильтр поиска для Active Directory
# Обычно используется sAMAccountName (имя учетной записи Windows)
LDAP_SEARCH_FILTER=(sAMAccountName={username})

# Опционально: Service Account для поиска в LDAP (если требуется)
# Если не указан, будет использоваться bind от имени пользователя
# LDAP_BIND_DN=cn=ServiceAccount,ou=Service Accounts,dc=company,dc=local
# LDAP_BIND_PASSWORD=service_account_password

# Timeout подключения к LDAP серверу (в секундах)
LDAP_TIMEOUT=10

# ===========================================
# JWT ТОКЕНЫ
# ===========================================

# Секретный ключ для подписи JWT токенов
# ВАЖНО: Сгенерируйте безопасный ключ для продакшена!
# Генерация: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=dev-secret-key-change-in-production-use-strong-random-string

# Время жизни access токена (в минутах)
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# Время жизни refresh токена (в днях)
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# ===========================================
# ТЕСТОВЫЕ ПОЛЬЗОВАТЕЛИ (Mock-режим)
# ===========================================
# Когда LDAP_ENABLED=false, используются встроенные тестовые пользователи:
# 
# Логин: admin    | Пароль: admin123  | Роль: Администратор
# Логин: user     | Пароль: user123   | Роль: Обычный пользователь
# Логин: test     | Пароль: test123   | Роль: Тестовый пользователь
#
# Эти пользователи НЕ требуют настройки LDAP и работают сразу "из коробки"

# ===========================================
# НАСТРОЙКИ ФАЙЛОВ
# ===========================================

# Загрузка файлов
UPLOAD_DIR=/app/uploads
MAX_FILE_SIZE=104857600  # 100MB
TEMP_DIR=/tmp/memoai

# Разрешенные расширения (через запятую)
ALLOWED_EXTENSIONS=.txt,.md,.pdf,.docx,.wav,.mp3,.mp4,.m4a,.flac,.ogg

# ===========================================
# НАСТРОЙКИ ЛОГИРОВАНИЯ
# ===========================================

# Общие настройки
LOG_LEVEL=INFO
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_CONSOLE=true

# Файлы логов
LOG_FILE_BACKEND=/app/logs/backend.log
LOG_FILE_LLM_SVC=/app/logs/llm-svc.log
LOG_MAX_SIZE=10485760  # 10MB
LOG_BACKUP_COUNT=5

# ===========================================
# НАСТРОЙКИ МОНИТОРИНГА
# ===========================================

# Health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30

# Метрики
METRICS_ENABLED=false
PROMETHEUS_PORT=9090
PROMETHEUS_PATH=/metrics

# ===========================================
# НАСТРОЙКИ WEBSOCKET
# ===========================================

# WebSocket соединения
WEBSOCKET_ENABLED=true
WEBSOCKET_PING_INTERVAL=30
WEBSOCKET_PING_TIMEOUT=10
WEBSOCKET_MAX_CONNECTIONS=100

# ===========================================
# НАСТРОЙКИ АГЕНТОВ
# ===========================================

# Агенты
AGENTS_ENABLED=true
DEFAULT_AGENT=general
ORCHESTRATOR_ENABLED=true
ORCHESTRATOR_MAX_ITERATIONS=10
ORCHESTRATOR_TIMEOUT=60
ORCHESTRATOR_PARALLEL_EXECUTION=false

# Доступные агенты (через запятую)
AVAILABLE_AGENTS=general,calculation,document,web_search,memory,mcp

# ===========================================
# НАСТРОЙКИ ИНСТРУМЕНТОВ
# ===========================================

# Инструменты
TOOLS_ENABLED=true

# Доступные инструменты (через запятую)
AVAILABLE_TOOLS=calculator,web_search,file_operations,memory_operations,mcp_tools

# ===========================================
# НАСТРОЙКИ РАЗРАБОТКИ
# ===========================================

# Hot reload
HOT_RELOAD=true
DEBUG_TOOLBAR=false
PROFILING=false
MOCK_LLM=false

# ===========================================
# НАСТРОЙКИ БАЗЫ ДАННЫХ (если используется)
# ===========================================

# MongoDB - для хранения диалогов
MONGODB_HOST=localhost # при запуске из контейнера поменять на mongodb
MONGODB_PORT=27017
MONGODB_DATABASE=memoai
#MONGODB_USER= # admin (расскоменьтить и поставить свой user)
#MONGODB_PASSWORD= # password (расскоменьтить и поставить свой пароль)
# Строка подключения формируется автоматически, но можно задать вручную:
# MONGODB_CONNECTION_STRING=mongodb://admin:password@mongodb:27017/ 
# (где user - это имя, которое задается в MONGODB_USER, а password - пароль, который задается в MONGODB_PASSWORD)

# PostgreSQL + pgvector - для RAG системы
POSTGRES_HOST=postgresql
POSTGRES_PORT=5432
POSTGRES_DB=memoai
POSTGRES_USER=admin
POSTGRES_PASSWORD=password
# Размерность векторов для эмбеддингов (по умолчанию 384 для multilingual-MiniLM)
EMBEDDING_DIM=384

# Настройки MinIO (для хранения файлов)
MINIO_ENDPOINT=minio
MINIO_PORT=9000
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_USE_SSL=false
MINIO_BUCKET_NAME=memoai-temp
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin

# ===========================================
# НАСТРОЙКИ ВНЕШНИХ СЕРВИСОВ
# ===========================================

# Hugging Face
# HUGGINGFACE_API_TOKEN=your-huggingface-token

# OpenAI (если используется)
# OPENAI_API_KEY=your-openai-key

# Google Cloud (если используется)
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# AWS (если используется)
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key
# AWS_DEFAULT_REGION=us-east-1

# ===========================================
# ПРИМЕРЫ КОМАНД
# ===========================================

# Запуск в режиме разработки:
# docker-compose up

# Запуск в продакшене:
# docker-compose -f docker-compose.prod.yml up

# Запуск только backend:
# docker-compose up memoai-backend

# Запуск только llm-svc:
# docker-compose up llm-svc

# Просмотр логов:
# docker-compose logs -f llm-svc
# docker-compose logs -f memoai-backend

# ===========================================
# ПРИМЕЧАНИЯ
# ===========================================

# 1. Все пути к моделям можно задавать как локальные, так и удаленные (S3, HTTP)
# 2. Переменные окружения имеют приоритет над значениями в конфигурационных файлах
# 3. Для продакшена обязательно установите ENABLE_SECURITY=true и задайте API_KEY
# 4. Размеры файлов указываются в байтах (104857600 = 100MB)
# 5. Временные интервалы указываются в секундах
# 6. Списки значений разделяются запятыми без пробелов
